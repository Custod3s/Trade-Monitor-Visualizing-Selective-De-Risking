<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alex HAAS, Viliam POHANCENIK, Pieter PEVERELLI">
<meta name="dcterms.date" content="2026-01-26">

<title>The Resilience Paradox: Mapping EU-China Strategic Trade and Financial Fragmentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="report_files/libs/clipboard/clipboard.min.js"></script>
<script src="report_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="report_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="report_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="report_files/libs/quarto-html/popper.min.js"></script>
<script src="report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="report_files/libs/quarto-html/anchor.min.js"></script>
<link href="report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="report_files/libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="report_files/libs/bootstrap/bootstrap-a74871fe4945b66d259aafc266475145.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction-the-geoeconomics-of-de-risking" id="toc-introduction-the-geoeconomics-of-de-risking" class="nav-link active" data-scroll-target="#introduction-the-geoeconomics-of-de-risking"><span class="header-section-number">0.1</span> Introduction: The Geoeconomics of De-risking</a>
  <ul class="collapse">
  <li><a href="#from-interdependence-to-economic-resilience" id="toc-from-interdependence-to-economic-resilience" class="nav-link" data-scroll-target="#from-interdependence-to-economic-resilience"><span class="header-section-number">0.1.1</span> From Interdependence to Economic Resilience</a></li>
  <li><a href="#addressing-asymmetric-dependencies" id="toc-addressing-asymmetric-dependencies" class="nav-link" data-scroll-target="#addressing-asymmetric-dependencies"><span class="header-section-number">0.1.2</span> Addressing Asymmetric Dependencies</a></li>
  </ul></li>
  <li><a href="#methodology-measuring-geoeconomic-re-securitization" id="toc-methodology-measuring-geoeconomic-re-securitization" class="nav-link" data-scroll-target="#methodology-measuring-geoeconomic-re-securitization"><span class="header-section-number">0.2</span> Methodology: Measuring Geoeconomic Re-securitization</a>
  <ul class="collapse">
  <li><a href="#data-acquisition-and-strategic-categorization" id="toc-data-acquisition-and-strategic-categorization" class="nav-link" data-scroll-target="#data-acquisition-and-strategic-categorization"><span class="header-section-number">0.2.1</span> Data Acquisition and Strategic Categorization</a></li>
  <li><a href="#econometric-framework-the-chow-test" id="toc-econometric-framework-the-chow-test" class="nav-link" data-scroll-target="#econometric-framework-the-chow-test"><span class="header-section-number">0.2.2</span> Econometric Framework: The Chow Test</a></li>
  </ul></li>
  <li><a href="#discussion-and-conclusion-evidence-of-selective-fragmentation" id="toc-discussion-and-conclusion-evidence-of-selective-fragmentation" class="nav-link" data-scroll-target="#discussion-and-conclusion-evidence-of-selective-fragmentation"><span class="header-section-number">0.3</span> Discussion and Conclusion: Evidence of Selective Fragmentation</a>
  <ul class="collapse">
  <li><a href="#empirical-validation-of-the-surgical-de-risking-hypothesis" id="toc-empirical-validation-of-the-surgical-de-risking-hypothesis" class="nav-link" data-scroll-target="#empirical-validation-of-the-surgical-de-risking-hypothesis"><span class="header-section-number">0.3.1</span> Empirical Validation of the “Surgical” De-risking Hypothesis</a></li>
  <li><a href="#from-market-logic-to-political-authority" id="toc-from-market-logic-to-political-authority" class="nav-link" data-scroll-target="#from-market-logic-to-political-authority"><span class="header-section-number">0.3.2</span> From Market Logic to Political Authority</a></li>
  <li><a href="#forecast-and-policy-implications" id="toc-forecast-and-policy-implications" class="nav-link" data-scroll-target="#forecast-and-policy-implications"><span class="header-section-number">0.3.3</span> Forecast and Policy Implications</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">1</span> References</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="report.md"><i class="bi bi-file-code"></i>Github (GFM)</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The Resilience Paradox: Mapping EU-China Strategic Trade and Financial Fragmentation</h1>
<p class="subtitle lead">2020–2026</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alex HAAS, Viliam POHANCENIK, Pieter PEVERELLI </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 26, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction-the-geoeconomics-of-de-risking" class="level2" data-number="0.1">
<h2 data-number="0.1" class="anchored" data-anchor-id="introduction-the-geoeconomics-of-de-risking"><span class="header-section-number">0.1</span> Introduction: The Geoeconomics of De-risking</h2>
<section id="from-interdependence-to-economic-resilience" class="level3" data-number="0.1.1">
<h3 data-number="0.1.1" class="anchored" data-anchor-id="from-interdependence-to-economic-resilience"><span class="header-section-number">0.1.1</span> From Interdependence to Economic Resilience</h3>
<p>The evolution of EU-China economic relations has undergone a fundamental departure from the <em>Wandel durch Handel</em> (change through trade) paradigm toward a strategy of “de-risking”. This shift is primarily aimed at correcting a trade deficit that reached €304.5 billion by 2024 and mitigating the risks of “coercive leverage” in critical supply chains.</p>
<p>Within this strategic pivot, this study examines whether EU import flows from China exhibit sector-specific structural breaks after 2020, indicating selective trade fragmentation between high-tech and traditional sectors. This research serves to bridge the gap between broad geopolitical trends—specifically the pursuit of “strategic autonomy”—and the granular empirical data that characterize the Union’s shifting trade architecture.</p>
</section>
<section id="addressing-asymmetric-dependencies" class="level3" data-number="0.1.2">
<h3 data-number="0.1.2" class="anchored" data-anchor-id="addressing-asymmetric-dependencies"><span class="header-section-number">0.1.2</span> Addressing Asymmetric Dependencies</h3>
<p>Despite this clear political shift toward strategic autonomy, there remains a gap in the empirical literature regarding whether these policy objectives have successfully translated into a measurable divergence in trade flows. This study addresses this gap by examining the “security-trade nexus,” analyzing whether EU import flows exhibit structural breaks following the geopolitical shocks of the early 2020s.</p>
<p>We hypothesize a dual-track geoeconomic reality: while traditional, low-value-added sectors governed by market-driven cost efficiencies should remain stable, high-tech industries—subject to the EU Chips Act, foreign investment screenings, and export controls—are expected to show significant fragmentation. This reflects the EU’s attempt to reduce asymmetric dependencies in sectors vital to the green and digital transitions.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-trends" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-trends-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="report_files/figure-html/fig-trends-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-trends-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: 3-Month Rolling Average of EU Trade with China by Sector Group. The red dashed line marks the start of the Economic Security Strategy.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="methodology-measuring-geoeconomic-re-securitization" class="level2" data-number="0.2">
<h2 data-number="0.2" class="anchored" data-anchor-id="methodology-measuring-geoeconomic-re-securitization"><span class="header-section-number">0.2</span> Methodology: Measuring Geoeconomic Re-securitization</h2>
<section id="data-acquisition-and-strategic-categorization" class="level3" data-number="0.2.1">
<h3 data-number="0.2.1" class="anchored" data-anchor-id="data-acquisition-and-strategic-categorization"><span class="header-section-number">0.2.1</span> Data Acquisition and Strategic Categorization</h3>
<p>The empirical foundation of this research rests on a high-frequency longitudinal dataset (2018–2025) constructed through automated API retrieval from the Eurostat (COMEXT) and Bank for International Settlements (BIS) databases. To test the hypothesis of “selective fragmentation,” trade flows are disaggregated using the Standard International Trade Classification (SITC) Revision 4:</p>
<ul>
<li><p><strong>Treatment Group (High-Tech &amp; Strategic):</strong> Comprising SITC 5 (Chemicals) and SITC 7 (Machinery/Transport). These sectors represent the core of the “security-trade nexus,” encompassing semiconductors and EV components.</p></li>
<li><p><strong>Control Group (Traditional &amp; Basic):</strong> Comprising SITC 6 (Manufactured goods) and SITC 8 (Miscellaneous). These sectors serve as a baseline for market-driven trade.</p></li>
</ul>
</section>
<section id="econometric-framework-the-chow-test" class="level3" data-number="0.2.2">
<h3 data-number="0.2.2" class="anchored" data-anchor-id="econometric-framework-the-chow-test"><span class="header-section-number">0.2.2</span> Econometric Framework: The Chow Test</h3>
<p>The primary analytical instrument utilized is the <strong>Chow Test</strong>, a standard in econometric literature for identifying “structural breaks” in time-series data. The model tests for a break point in <strong>January 2023</strong>, coinciding with the formal adoption of the European Economic Security Strategy.</p>
<p>A significantly higher F-statistic in SITC 5 and 7 relative to SITC 6 and 8 would provide robust evidence of a “surgical” geoeconomic decoupling.</p>
</section>
</section>
<section id="discussion-and-conclusion-evidence-of-selective-fragmentation" class="level2" data-number="0.3">
<h2 data-number="0.3" class="anchored" data-anchor-id="discussion-and-conclusion-evidence-of-selective-fragmentation"><span class="header-section-number">0.3</span> Discussion and Conclusion: Evidence of Selective Fragmentation</h2>
<section id="empirical-validation-of-the-surgical-de-risking-hypothesis" class="level3" data-number="0.3.1">
<h3 data-number="0.3.1" class="anchored" data-anchor-id="empirical-validation-of-the-surgical-de-risking-hypothesis"><span class="header-section-number">0.3.1</span> Empirical Validation of the “Surgical” De-risking Hypothesis</h3>
<p>The results of the structural break analysis provide compelling evidence that the European Union’s trade architecture is undergoing a fundamental re-orientation.</p>
<p>For the <strong>Treatment Group (High-Tech &amp; Strategic)</strong>, the model yielded an F-statistic of <strong>3.42</strong> (p &lt; 0.0001). This highly significant value indicates a definitive structural break. Conversely, while the <strong>Control Group</strong> also showed a significant break, the magnitude was markedly lower (F = <strong>0.01</strong>).</p>
<p>To visualize this shift beyond abstract statistics, we examine the distribution of monthly trade values. As shown in Figure 2, the high-tech sector displays a distinct compression and downward shift in value distribution after the 2023 policy implementation, whereas traditional trade distributions remain largely overlapping.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-boxplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="report_files/figure-html/fig-boxplot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Distribution of Monthly Trade Values: Before vs.&nbsp;After the Economic Security Strategy (Jan 2023).
</figcaption>
</figure>
</div>
</div>
</div>
<p>The Intensity Ratio of approximately 503.3 x is the most salient finding of this study. It confirms that the “de-risking” agenda is not merely a byproduct of a generalized economic slowdown, but a targeted intervention in the “security-trade nexus.</p>
</section>
<section id="from-market-logic-to-political-authority" class="level3" data-number="0.3.2">
<h3 data-number="0.3.2" class="anchored" data-anchor-id="from-market-logic-to-political-authority"><span class="header-section-number">0.3.2</span> From Market Logic to Political Authority</h3>
<p>Recognizing that geoeconomics is inherently multi-disciplinary, we integrate trade data with financial flows from the BIS to capture the “finance-trade nexus”.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-scatter" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-scatter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="report_files/figure-html/fig-scatter-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-scatter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Correlation between Financial Exposure and Strategic Trade. The positive slope suggests banks and importers are de-risking in tandem.
</figcaption>
</figure>
</div>
</div>
</div>
<p>As shown in Figure 4, the Wandel durch Handel paradigm has been replaced by a “dual-track” reality. While traditional goods continue to follow the logic of comparative advantage, high-tech sectors and banking exposure are now governed by the logic of “security-of-supply”.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-unified" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-unified-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="report_files/figure-html/fig-unified-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-unified-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: The Dual De-Risking: Trade &amp; Finance Divergence. Since Jan 2023, EU Banks and High-Tech Importers have both reduced exposure.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="forecast-and-policy-implications" class="level3" data-number="0.3.3">
<h3 data-number="0.3.3" class="anchored" data-anchor-id="forecast-and-policy-implications"><span class="header-section-number">0.3.3</span> Forecast and Policy Implications</h3>
<p>Looking ahead, we project the “New Normal” trajectory for strategic trade. Based on the post-break trend (Jan 2023–Present), the model suggests a continued stabilization at lower levels rather than a rebound to pre-2022 highs.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-forecast" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-forecast-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="report_files/figure-html/fig-forecast-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-forecast-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Projecting the ‘De-risking’ Trend into 2026 based on linear extrapolation of the post-break trajectory.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In conclusion, the European market has become a fragmented landscape where political security considerations increasingly supersede traditional market logic. As we look toward 2027, the challenge will be maintaining this “surgical” precision without devolving into broader protectionism.</p>
</section>
</section>
<section id="references" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> References</h1>
<ol type="1">
<li><p>Bank for International Settlements. (2026). Locational banking statistics.</p></li>
<li><p>Chow, G. C. (1960). Tests of equality between sets of coefficients in two linear regressions. <em>Econometrica</em>.</p></li>
<li><p>European Commission. (n.d.). China Trade Relationships.</p></li>
<li><p>Eurostat. (2026). Euro area trade by SITC product group.</p></li>
<li><p>McNamara, K. R. (2024). Transforming Europe? The EU’s industrial policy and geopolitical turn. <em>Journal of European Public Policy</em>.</p></li>
<li><p>Pereira, I. T. (2025). What are the most imported and exported products between China and the EU? <em>Euronews</em>.</p></li>
<li><p>Vandermeeren, F. (2024). Understanding EU-China economic exposure. <em>European Commission</em>.</p></li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>